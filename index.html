<script>
    // ğŸ”´ğŸ”´ğŸ”´ è«‹å‹™å¿…å¡«å¯«æ‚¨çš„ Google Script ç¶²å€ (ä»¥ /exec çµå°¾) ğŸ”´ğŸ”´ğŸ”´
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwNGeCd75Ifth9tIcwoooZxfAL7Ftfaqtuc-Gy7w24JSnxeIay7bg3z9yeCwVRkYajI/exec";

    // æ–°å¢é€£çµæ¬„ä½åŠŸèƒ½
    function addLinkField() {
        const container = document.getElementById('linkContainer');
        const newDiv = document.createElement('div');
        newDiv.className = 'flex gap-2 link-group animate-fade-in';
        newDiv.innerHTML = `
            <input type="text" name="link[]"
                class="w-full px-5 py-3 rounded-2xl glass-input text-gray-700 font-medium placeholder-gray-400 link-input"
                placeholder="å¦ä¸€å€‹é€£çµ...">
            <button type="button" onclick="this.parentElement.remove()" class="text-gray-400 hover:text-red-500 px-2 btn-icon">
                âœ•
            </button>
        `;
        container.appendChild(newDiv);
    }

    function submitData() {
      var btn = document.getElementById('submitBtn');
      
      // 1. æŠ“å–è³‡æ–™
      var userName = document.getElementById('userName').value.trim();
      var client = document.getElementById('client').value.trim();   // æ–°æ¬„ä½
      var project = document.getElementById('project').value.trim();
      var spec = document.getElementById('spec').value.trim();
      var deadline = document.getElementById('deadline').value;
      var draftDate = document.getElementById('draftDate').value;    // æ–°æ¬„ä½
      
      // æ”¶é›†æ‰€æœ‰é€£çµ
      var linkInputs = document.querySelectorAll('.link-input');
      var links = [];
      linkInputs.forEach(input => {
          if(input.value.trim() !== "") {
              links.push(input.value.trim());
          }
      });
      var linkString = links.join('\n');

      // 2. æª¢æŸ¥å¿…å¡«
      if (userName === "" || project === "" || client === "") {
        Swal.fire({
          icon: 'warning',
          title: 'æ±ªæ±ªï¼ç¼ºè³‡æ–™',
          text: 'è«‹è‡³å°‘å¡«å¯«ã€Œå¬å–šè€…ã€ã€ã€Œå®¢æˆ¶ã€å’Œã€Œé …ç›®åç¨±ã€',
          confirmButtonColor: '#FF9A9E',
          iconColor: '#FF9A9E',
          background: 'rgba(255,255,255,0.95)',
          customClass: { popup: 'rounded-2xl' }
        });
        return;
      }

      // 3. é–å®šæŒ‰éˆ•
      btn.disabled = true;
      const originalHTML = btn.innerHTML;
      btn.innerHTML = 'ğŸ• ç‹—ç‹—å¥”è·‘ä¸­...';
      
      // 4. æ‰“åŒ…è³‡æ–™
      var formData = {
        userName: userName,
        client: client,
        project: project,
        spec: spec,
        deadline: deadline,
        draftDate: draftDate,
        link: linkString
      };

      // 5. ä½¿ç”¨ fetch ç™¼é€ (é€™æ˜¯ GitHub å°ˆç”¨çš„å¯«æ³•)
      fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(formData),
        mode: "no-cors"
      }).then(() => {
        // æˆåŠŸå¾ŒåŸ·è¡Œ
        Swal.fire({
            icon: 'success',
            title: 'ä»»å‹™æ”¶åˆ°ï¼',
            text: 'ç‹—ç‹—å·²ç¶“æŠŠéœ€æ±‚å’¬èµ°äº†ï¼',
            confirmButtonColor: '#FF9A9E',
            iconColor: '#FF9A9E',
            customClass: { popup: 'rounded-2xl' }
        }).then(() => {
            document.getElementById('taskForm').reset();
            // é‡ç½®é€£çµæ¬„ä½
            document.getElementById('linkContainer').innerHTML = `
                <div class="flex gap-2 link-group">
                    <input type="text" name="link[]"
                        class="w-full px-5 py-3 rounded-2xl glass-input text-gray-700 font-medium placeholder-gray-400 link-input"
                        placeholder="è²¼ä¸Šç¶²å€æˆ–å…§éƒ¨è·¯å¾‘ (å¦‚ \\\\Server\\Files)">
                </div>
            `;
            btn.disabled = false;
            btn.innerHTML = originalHTML;
        });
      }).catch(err => {
        // å¤±æ•—æ™‚åŸ·è¡Œ
        console.error(err);
        Swal.fire({
            icon: 'error',
            title: 'å—·å—š...',
            text: 'ç¶²è·¯æ€ªæ€ªçš„ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚',
        });
        btn.disabled = false;
        btn.innerHTML = originalHTML;
      });
    }
  </script>
